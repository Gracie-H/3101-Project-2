---
layout: base.html
title: Home
---

<!-- 过滤条：Category + Price Range -->
<div class="filters">
  <select id="filter-category" aria-label="Category">
    <option value="">All categories</option>
    <option value="perfume">perfume</option>
    <option value="jewelry">jewelry</option>
    <option value="shoes">shoes</option>
    <option value="vase">vase</option>
    <option value="decoration">tableware</option>
  </select>

  <select id="filter-price" aria-label="Price range">
    <option value="">All prices</option>
    <option value="0-100">0–100 USD</option>
    <option value="100-200">100–200 USD</option>
    <option value="200-300">200–300 USD</option>
    <option value="300+">300+ USD</option>
  </select>
</div>

<!-- 2.5D 漂浮场景 -->
<div id="scene">
  <div id="space">
    {% for post in collections.entry | reverse %}
      {% set price = post.data.price %}
      {% set currency = post.data.currency or "USD" %}
      <a
        class="item"
        href="{{ post.url }}"
        title="{{ post.data.title }}"
        data-category="{{ post.data.category or '' }}"
        data-price="{{ price or '' }}"
      >
        {% if post.data.cover %}
          <img src="{{ post.data.image }}" alt="{{ post.data.title }}">
        {% endif %}
        <span class="label">
          <strong>{{ post.data.title }}</strong>
          {% if price %}
            <span class="price"> — ${{ price }} {{ currency }}</span>
          {% endif %}
        </span>
      </a>
    {% endfor %}
  </div>
</div>

<script>
  // ========== 基础 ==========
  const space = document.getElementById("space");
  const items = Array.from(document.querySelectorAll(".item"));

  // ========== 随机 2.5D 布局 ==========
  function layoutRandom() {
    const w = space.clientWidth;
    const h = space.clientHeight;

    items.forEach((el) => {
      const x = (Math.random() * 2 - 1) * w * 0.9;
      const y = (Math.random() * 2 - 1) * h * 0.9;
      const z = -1200 + Math.random() * 1600;

      el.style.transform = `
        translate3d(${x}px, ${y}px, ${z}px)
        rotateY(${(Math.random() * 10 - 5).toFixed(2)}deg)
        rotateX(${(Math.random() * 6 - 3).toFixed(2)}deg)
      `;
    });
  }

  // ========== 拖拽 / 滚轮 ==========
  let sx = 0, sy = 0, tx = 0, ty = 0, isDown = false;

  function applyTransform() {
    space.style.transform = `translate3d(${tx}px, ${ty}px, 0)`;
  }

  space.addEventListener("wheel", (e) => {
    tx -= e.deltaX * 0.6;
    ty -= e.deltaY * 0.6;
    applyTransform();
  });

  space.addEventListener("mousedown", (e) => {
    isDown = true;
    sx = e.clientX - tx;
    sy = e.clientY - ty;
  });

  window.addEventListener("mousemove", (e) => {
    if (!isDown) return;
    tx = e.clientX - sx;
    ty = e.clientY - sy;
    applyTransform();
  });

  window.addEventListener("mouseup", () => { isDown = false; });

  // ========== 过滤（Category + 价格区间） ==========
  const categorySel = document.getElementById("filter-category");
  const priceSel    = document.getElementById("filter-price");

  // 将数值价格映射到区间 key
  function bucketOf(priceNum) {
    if (isNaN(priceNum)) return "";          // 没写价格：不过滤
    if (priceNum < 100) return "0-100";
    if (priceNum < 200) return "100-200";
    if (priceNum < 300) return "200-300";
    return "300+";
  }

  function applyFilter() {
    const C = categorySel.value.trim();
    const P = priceSel.value.trim();

    items.forEach((el) => {
      const okC = !C || el.dataset.category === C;

      const num = parseFloat((el.dataset.price || "").toString().replace(/[^\d.]/g, ""));
      const bucket = bucketOf(num);
      const okP = !P || bucket === P;

      el.classList.toggle("hidden", !(okC && okP));
    });
  }

  [categorySel, priceSel].forEach((el) => el.addEventListener("change", applyFilter));

  // ========== 夸张动画：随机参数 + 3D 倾斜 + 自动漂移 ==========
  // 为每张图写入随机 CSS 变量（节奏/振幅/高光时长）
  items.forEach((el) => {
    const img = el.querySelector("img");
    if (!img) return;

    const bobD   = 4 + Math.random() * 4;     // 4–8s
    const bobLag = -Math.random() * bobD;     // 负延迟错峰
    const amp    = 10 + Math.random() * 20;   // 10–30px
    const glareD = 3.2 + Math.random() * 2.2; // 3.2–5.4s

    img.style.setProperty("--bobD", `${bobD}s`);
    img.style.setProperty("--bobDelay", `${bobLag}s`);
    img.style.setProperty("--glareD", `${glareD}s`);
    img.style.setProperty("--amp", `${amp}px`);
  });

  // 悬停 3D 倾斜
  const MAX_TILT = 10;
  items.forEach((el) => {
    const img = el.querySelector("img");
    if (!img) return;

    img.addEventListener("mousemove", (e) => {
      const r = img.getBoundingClientRect();
      const rx = ((e.clientY - r.top) / r.height - 0.5) * -2;
      const ry = ((e.clientX - r.left) / r.width  - 0.5) *  2;
      img.style.transform =
        `rotateX(${rx * MAX_TILT}deg) rotateY(${ry * MAX_TILT}deg) translateZ(16px) scale(1.08)`;
    });
    img.addEventListener("mouseleave", () => { img.style.transform = ""; });
  });

  // 自动相机漂移
  let ax = 0, ay = 0, t0 = performance.now();
  function autoDrift(now) {
    const dt = (now - t0) / 1000;
    ax = Math.sin(dt * 0.35) * 24;
    ay = Math.cos(dt * 0.25) * 16;
    space.style.transform = `translate3d(${tx + ax}px, ${ty + ay}px, 0)`;
    requestAnimationFrame(autoDrift);
  }
  requestAnimationFrame(autoDrift);

  // ========== 初始 ==========
  layoutRandom();
  applyTransform();
  applyFilter();
  window.addEventListener("resize", layoutRandom);
</script>
